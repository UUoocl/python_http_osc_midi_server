<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>http_server &#8212; Python HTTP OSC MIDI Server 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=8d563738"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for http_server</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">obspython</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">obs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">http.server</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">socketserver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>

<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># GLOBAL VARIABLES</span>
<span class="c1"># -------------------------------------------------------------------</span>
<span class="n">WSS_DETAILS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;IP&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PORT&quot;</span><span class="p">:</span> <span class="mi">4455</span><span class="p">,</span>
    <span class="s2">&quot;PW&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
<span class="p">}</span>
<span class="n">HTTP_SERVER_INSTANCE</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">SERVER_THREAD</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">CURRENT_HTTP_PORT</span> <span class="o">=</span> <span class="mi">8080</span>
<span class="c1"># Set SCRIPT_DIR to the parent directory of the script&#39;s location</span>
<span class="n">SCRIPT_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>

<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># SERVER CLASSES</span>
<span class="c1"># -------------------------------------------------------------------</span>

<div class="viewcode-block" id="ThreadingHTTPServer">
<a class="viewcode-back" href="../python_scripts.html#http_server.ThreadingHTTPServer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ThreadingHTTPServer</span><span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">ThreadingMixIn</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle requests in separate threads and allow immediate port reuse.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">allow_reuse_address</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">daemon_threads</span> <span class="o">=</span> <span class="kc">True</span></div>


<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># CONFIG LOADING LOGIC (Adapted from 01_load_wss_config.py)</span>
<span class="c1"># -------------------------------------------------------------------</span>

<div class="viewcode-block" id="update_wss_details">
<a class="viewcode-back" href="../python_scripts.html#http_server.update_wss_details">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_wss_details</span><span class="p">(</span><span class="n">source_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses the selected JSON config file and updates the global WSS_DETAILS variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">WSS_DETAILS</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;File not found or not selected.&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="n">source_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>

        <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;server_password&quot;</span><span class="p">,</span> <span class="s2">&quot;server_port&quot;</span><span class="p">]</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required_keys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_data</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Missing keys: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Update Global Variable</span>
        <span class="n">WSS_DETAILS</span><span class="p">[</span><span class="s2">&quot;PW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;server_password&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">WSS_DETAILS</span><span class="p">[</span><span class="s2">&quot;PORT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">source_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;server_port&quot;</span><span class="p">,</span> <span class="mi">4455</span><span class="p">))</span>
        
        <span class="c1"># IP is usually localhost for local configs, unless specified</span>
        <span class="n">WSS_DETAILS</span><span class="p">[</span><span class="s2">&quot;IP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span> 

        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Loaded successfully.&quot;</span>

    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Invalid JSON.&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>


<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># HTTP SERVER LOGIC</span>
<span class="c1"># -------------------------------------------------------------------</span>

<div class="viewcode-block" id="OBSServerHandler">
<a class="viewcode-back" href="../python_scripts.html#http_server.OBSServerHandler">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">OBSServerHandler</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom Request Handler to mimic the Fastify routes in serverLogic.ts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Set the directory to serve static files from (Script Directory)</span>
        <span class="c1"># Note: &#39;directory&#39; kwarg is available in Python 3.7+. </span>
        <span class="c1"># We assume OBS uses a relatively modern Python.</span>
        <span class="k">if</span> <span class="n">SCRIPT_DIR</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">SCRIPT_DIR</span><span class="p">):</span>
             <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">SCRIPT_DIR</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="OBSServerHandler.log_message">
<a class="viewcode-back" href="../python_scripts.html#http_server.OBSServerHandler.log_message">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">log_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c1"># Suppress logging to keep OBS log clean, or uncomment to debug</span>
        <span class="c1"># obs.script_log(obs.LOG_INFO, format % args)</span>
        <span class="k">pass</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_send_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="c1"># Enable CORS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_send_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_json</span><span class="p">({</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">},</span> <span class="n">code</span><span class="p">)</span>

<div class="viewcode-block" id="OBSServerHandler.do_GET">
<a class="viewcode-back" href="../python_scripts.html#http_server.OBSServerHandler.do_GET">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parsed_path</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">path_path</span> <span class="o">=</span> <span class="n">parsed_path</span><span class="o">.</span><span class="n">path</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed_path</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># --- API: Get OBS Credentials ---</span>
        <span class="c1"># Route: /api/obswss</span>
        <span class="k">if</span> <span class="n">path_path</span> <span class="o">==</span> <span class="s1">&#39;/api/obswss&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_json</span><span class="p">(</span><span class="n">WSS_DETAILS</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># --- API: Generic File List ---</span>
        <span class="c1"># Route: /api/file/list?folder=...</span>
        <span class="k">elif</span> <span class="n">path_path</span> <span class="o">==</span> <span class="s1">&#39;/api/file/list&#39;</span><span class="p">:</span>
            <span class="n">folder_list</span> <span class="o">=</span> <span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;Missing folder parameter&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="n">target_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SCRIPT_DIR</span><span class="p">,</span> <span class="n">folder_list</span><span class="p">)</span>
            
            <span class="c1"># Security check: Ensure path is within SCRIPT_DIR</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">SCRIPT_DIR</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;Access denied&quot;</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_json</span><span class="p">([])</span>
                <span class="k">return</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_json</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="c1"># --- API: Generic File Get ---</span>
        <span class="c1"># Route: /api/file/get?folder=...&amp;filename=...</span>
        <span class="k">elif</span> <span class="n">path_path</span> <span class="o">==</span> <span class="s1">&#39;/api/file/get&#39;</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;Missing folder or filename parameter&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">target_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SCRIPT_DIR</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">SCRIPT_DIR</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;Access denied&quot;</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;File not found&quot;</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Optimized: Read bytes directly to avoid redundant JSON parsing/serialization</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">obs</span><span class="o">.</span><span class="n">script_log</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">LOG_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error reading file: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="c1"># Fallback to serving static files</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">do_GET</span><span class="p">()</span></div>


<div class="viewcode-block" id="OBSServerHandler.do_POST">
<a class="viewcode-back" href="../python_scripts.html#http_server.OBSServerHandler.do_POST">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parsed_path</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        
        <span class="c1"># --- API: Generic File Save ---</span>
        <span class="c1"># Route: /api/file/save</span>
        <span class="k">if</span> <span class="n">parsed_path</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/api/file/save&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">])</span>
                <span class="n">post_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

                <span class="n">folder</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;folder&#39;</span><span class="p">)</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">filename</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;Missing folder, filename, or data&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="n">target_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SCRIPT_DIR</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                
                <span class="c1"># Append .json if missing</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;.json&#39;</span>
                
                <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">SCRIPT_DIR</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;Access denied: Path outside root&quot;</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create directory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_send_json</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">full_path</span><span class="p">})</span>
            
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="c1"># --- API: OSC Send (Communication with osc_io_browserSource.py) ---</span>
        <span class="c1"># Route: /api/osc/send</span>
        <span class="k">if</span> <span class="n">parsed_path</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/api/osc/send&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">])</span>
                <span class="n">post_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

                <span class="n">event_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;event_name&#39;</span><span class="p">)</span>
                <span class="n">address</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;address&#39;</span><span class="p">)</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="p">[])</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">address</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">event_name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;Missing OSC address or event_name&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="c1"># Check for the shared OSC manager from the other script</span>
                <span class="n">osc_manager</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="s1">&#39;osc_manager&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">osc_manager</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;OSC Script not loaded or registered&quot;</span><span class="p">,</span> <span class="mi">503</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="n">clients</span> <span class="o">=</span> <span class="n">osc_manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;clients&quot;</span><span class="p">,</span> <span class="p">[])</span>
                
                <span class="c1"># Find the client by unique event_name</span>
                <span class="n">target_client</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clients</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">event_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="ow">not</span> <span class="n">target_client</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Client with event_name &#39;</span><span class="si">{</span><span class="n">event_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="c1"># Execute the send via the shared manager</span>
                <span class="n">osc_manager</span><span class="p">[</span><span class="s2">&quot;send&quot;</span><span class="p">](</span><span class="n">target_client</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_json</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">obs</span><span class="o">.</span><span class="n">script_log</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">LOG_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;OSC Send Error: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="c1"># --- API: MIDI Send (Communication with midi_io.py) ---</span>
        <span class="c1"># Route: /api/midi/send</span>
        <span class="k">if</span> <span class="n">parsed_path</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/api/midi/send&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">])</span>
                <span class="n">post_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">content_length</span><span class="p">)</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">post_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

                <span class="n">event_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;event_name&#39;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="c1"># Expecting hex string or list of ints</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">event_name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;Missing MIDI data or event_name&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="c1"># Check for the shared MIDI manager</span>
                <span class="n">midi_manager</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="s1">&#39;midi_manager&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">midi_manager</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="s2">&quot;MIDI Script not loaded or registered&quot;</span><span class="p">,</span> <span class="mi">503</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="c1"># Execute the send via the shared manager</span>
                <span class="n">success</span> <span class="o">=</span> <span class="n">midi_manager</span><span class="p">[</span><span class="s2">&quot;send&quot;</span><span class="p">](</span><span class="n">event_name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_json</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Device with event_name &#39;</span><span class="si">{</span><span class="n">event_name</span><span class="si">}</span><span class="s2">&#39; not found or send failed&quot;</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">obs</span><span class="o">.</span><span class="n">script_log</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">LOG_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;MIDI Send Error: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span>
        
        <span class="c1"># Fallback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_error</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span></div>


<div class="viewcode-block" id="OBSServerHandler.do_OPTIONS">
<a class="viewcode-back" href="../python_scripts.html#http_server.OBSServerHandler.do_OPTIONS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">do_OPTIONS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Handle CORS preflight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">,</span> <span class="s1">&#39;GET, POST, OPTIONS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span></div>
</div>


<div class="viewcode-block" id="start_server">
<a class="viewcode-back" href="../python_scripts.html#http_server.start_server">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">start_server</span><span class="p">(</span><span class="n">port</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">HTTP_SERVER_INSTANCE</span><span class="p">,</span> <span class="n">SERVER_THREAD</span>
    
    <span class="c1"># Stop existing if any</span>
    <span class="n">stop_server</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Using ThreadingHTTPServer for concurrency and reliable port reuse</span>
        <span class="n">HTTP_SERVER_INSTANCE</span> <span class="o">=</span> <span class="n">ThreadingHTTPServer</span><span class="p">((</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">OBSServerHandler</span><span class="p">)</span>
        
        <span class="n">SERVER_THREAD</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">HTTP_SERVER_INSTANCE</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">)</span>
        <span class="n">SERVER_THREAD</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">SERVER_THREAD</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Server started on port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">obs</span><span class="o">.</span><span class="n">script_log</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">LOG_INFO</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;HTTP Server started on 127.0.0.1:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">obs</span><span class="o">.</span><span class="n">script_log</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">LOG_ERROR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed to start server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">HTTP_SERVER_INSTANCE</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="stop_server">
<a class="viewcode-back" href="../python_scripts.html#http_server.stop_server">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stop_server</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">HTTP_SERVER_INSTANCE</span><span class="p">,</span> <span class="n">SERVER_THREAD</span>
    <span class="k">if</span> <span class="n">HTTP_SERVER_INSTANCE</span><span class="p">:</span>
        <span class="n">HTTP_SERVER_INSTANCE</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="n">HTTP_SERVER_INSTANCE</span><span class="o">.</span><span class="n">server_close</span><span class="p">()</span>
        <span class="n">HTTP_SERVER_INSTANCE</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">SERVER_THREAD</span><span class="p">:</span>
        <span class="n">SERVER_THREAD</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">SERVER_THREAD</span> <span class="o">=</span> <span class="kc">None</span></div>


<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># OBS SCRIPT CALLBACKS</span>
<span class="c1"># -------------------------------------------------------------------</span>

<div class="viewcode-block" id="script_description">
<a class="viewcode-back" href="../python_scripts.html#http_server.script_description">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">script_description</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;&quot;&lt;b&gt;Python HTTP Server &amp; WSS Loader&lt;/b&gt;</span>
<span class="s2">    &lt;hr&gt;</span>
<span class="s2">    &lt;p&gt;Host local files and provide API endpoints for browser sources.&lt;/p&gt;</span>
<span class="s2">    &lt;p&gt;Server runs on 127.0.0.1&lt;/p&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="script_load">
<a class="viewcode-back" href="../python_scripts.html#http_server.script_load">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">script_load</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">SCRIPT_DIR</span>
    <span class="c1"># Update WSS details from saved path</span>
    <span class="n">wss_path</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">obs_data_get_string</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;wss_config_path&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wss_path</span><span class="p">:</span>
        <span class="n">update_wss_details</span><span class="p">(</span><span class="n">wss_path</span><span class="p">)</span>

    <span class="c1"># Start Server</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">obs_data_get_int</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;http_port&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">port</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">port</span> <span class="o">=</span> <span class="mi">8080</span> <span class="c1"># Default</span>
    
    <span class="k">global</span> <span class="n">CURRENT_HTTP_PORT</span>
    <span class="n">CURRENT_HTTP_PORT</span> <span class="o">=</span> <span class="n">port</span>
    <span class="n">start_server</span><span class="p">(</span><span class="n">CURRENT_HTTP_PORT</span><span class="p">)</span></div>


<div class="viewcode-block" id="script_unload">
<a class="viewcode-back" href="../python_scripts.html#http_server.script_unload">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">script_unload</span><span class="p">():</span>
    <span class="n">stop_server</span><span class="p">()</span></div>


<div class="viewcode-block" id="on_wss_path_changed">
<a class="viewcode-back" href="../python_scripts.html#http_server.on_wss_path_changed">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">on_wss_path_changed</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">obs_data_get_string</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;wss_config_path&quot;</span><span class="p">)</span>
    <span class="n">success</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">update_wss_details</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">obs</span><span class="o">.</span><span class="n">obs_data_set_string</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;status_text&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="on_port_changed">
<a class="viewcode-back" href="../python_scripts.html#http_server.on_port_changed">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">on_port_changed</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">CURRENT_HTTP_PORT</span>
    <span class="n">new_port</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">obs_data_get_int</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;http_port&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">new_port</span> <span class="o">!=</span> <span class="n">CURRENT_HTTP_PORT</span><span class="p">:</span>
        <span class="n">CURRENT_HTTP_PORT</span> <span class="o">=</span> <span class="n">new_port</span>
        <span class="n">start_server</span><span class="p">(</span><span class="n">CURRENT_HTTP_PORT</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="script_properties">
<a class="viewcode-back" href="../python_scripts.html#http_server.script_properties">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">script_properties</span><span class="p">():</span>
    <span class="n">props</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">obs_properties_create</span><span class="p">()</span>

    <span class="c1"># WSS Config Selection</span>
    <span class="n">obs</span><span class="o">.</span><span class="n">obs_properties_add_path</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s2">&quot;wss_config_path&quot;</span><span class="p">,</span> <span class="s2">&quot;WSS Config File&quot;</span><span class="p">,</span> <span class="n">obs</span><span class="o">.</span><span class="n">OBS_PATH_FILE</span><span class="p">,</span> <span class="s2">&quot;JSON Files (*.json);;All Files (*.*)&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    
    <span class="c1"># Status display</span>
    <span class="n">obs</span><span class="o">.</span><span class="n">obs_properties_add_text</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s2">&quot;status_text&quot;</span><span class="p">,</span> <span class="s2">&quot;Config Status&quot;</span><span class="p">,</span> <span class="n">obs</span><span class="o">.</span><span class="n">OBS_TEXT_MULTILINE</span><span class="p">)</span>

    <span class="c1"># HTTP Port</span>
    <span class="n">p_port</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">obs_properties_add_int</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s2">&quot;http_port&quot;</span><span class="p">,</span> <span class="s2">&quot;HTTP Port&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">65535</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Callbacks</span>
    <span class="n">obs</span><span class="o">.</span><span class="n">obs_property_set_modified_callback</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">obs_properties_get</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="s2">&quot;wss_config_path&quot;</span><span class="p">),</span> <span class="n">on_wss_path_changed</span><span class="p">)</span>
    <span class="n">obs</span><span class="o">.</span><span class="n">obs_property_set_modified_callback</span><span class="p">(</span><span class="n">p_port</span><span class="p">,</span> <span class="n">on_port_changed</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">props</span></div>


<div class="viewcode-block" id="script_defaults">
<a class="viewcode-back" href="../python_scripts.html#http_server.script_defaults">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">script_defaults</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
    <span class="n">obs</span><span class="o">.</span><span class="n">obs_data_set_default_int</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;http_port&quot;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Python HTTP OSC MIDI Server</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_scripts.html">Python Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../frontend.html">Frontend Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commentary.html">Developer Commentary</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, Jon Wood.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.0.4</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>